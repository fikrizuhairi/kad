// Code.gs
const SPREADSHEET_ID = '1yR5vYYyelb-969ArYrAsQiv91wjBri76lG8s9bPY_tM';
const SHEET_NAME = 'guest';

function doGet(e){
  return HtmlService.createHtmlOutputFromFile('Index')
    .setTitle('Wish');
}

// Accept external POSTs if needed
function doPost(e){
  try {
    var params = e.parameter || {};
    submitForm(params);
    return ContentService.createTextOutput(JSON.stringify({status:'success'}))
      .setMimeType(ContentService.MimeType.JSON);
  } catch (err) {
    return ContentService.createTextOutput(JSON.stringify({status:'error', message: err.message}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function submitForm(data){
  data = data || {};
  var nama = (typeof data.nama !== 'undefined') ? String(data.nama).trim() : '';
  // Ensure jumlah is numeric-ish; default to 1 if blank
  var ucapan = (typeof data.ucapan !== 'undefined') ? String(data.ucapan).trim() : '';


  var timestamp = new Date();

  var ss = SpreadsheetApp.openById(SPREADSHEET_ID);
  var sheet = ss.getSheetByName(SHEET_NAME);
  if (!sheet) {
    sheet = ss.insertSheet(SHEET_NAME);
    sheet.appendRow(['Timestamp', 'Nama', 'Ucapan']);
  }

  // Append row
  sheet.appendRow([timestamp, nama, ucapan]);

  return {status: 'success', message: 'Terima kasih â€” Ucapan anda telah dihantar.'};
}

